---
sidebar_position: 1
description: "Invoke handlers over HTTP."
---

import Admonition from '@theme/Admonition';

# HTTP

You can invoke handlers over HTTP with or without waiting for a response, and with or without an idempotency key.

<Admonition type="info">
    Make sure to first [register the handler](/operate/registration) you want to invoke.
</Admonition>

## Request-response calls over HTTP
You can invoke services over HTTP 1.1 or higher.
Request/response bodies should be encoded as JSON.

<CH.Spotlight>
    ### Invoking Services
    Invoke `myHandler` of `myService` as follows:

    ```shell
    curl localhost:8080/MyService/myHandler \
        -H 'content-type: application/json' \
        -d '{"name": "Mary", "age": 25}'
    ```

</CH.Spotlight>
<CH.Spotlight>

    ### Invoking Virtual Objects
    Invoke `myHandler` of `myVirtualObject` for `myKey` as follows:

    ```shell
    curl localhost:8080/MyVirtualObject/myObjectKey/myHandler \
        -H 'content-type: application/json' \
        -d '{"name": "Mary", "age": 25}'
    ```

</CH.Spotlight>
<CH.Spotlight>

    ### Invoke Workflows
    Call the `run` handler of the `MyWorkflow` as follows:

    ```shell
    curl localhost:8080/MyWorkflow/myWorkflowId/run \
        -H 'content-type: application/json' \
        -d '{"name": "Mary", "age": 25}'
    ```

</CH.Spotlight>


Follow the same pattern for calling the other handlers of the workflow.

<Admonition type="info" title="Restate as proxy">
    Note that all invocations go first via the Restate Server. The server then forwards the request to the appropriate service.
    Therefore, `localhost:8080` refers to ingress port of the Restate Server, not the service instance.
</Admonition>

## Sending a message over HTTP
If you do not want to wait for the response, you can also send a message by adding `/send` to the URL path:

```shell
# focus[40:44]
curl localhost:8080/MyService/myHandler/send \
    -H 'content-type: application/json' \
    -d '{"name": "Mary", "age": 25}'
```

<details className={"grey-details"}>
    <summary>Output</summary>

    ```json
    {"invocationId":"inv_1aiqX0vFEFNH1Umgre58JiCLgHfTtztYK5"}
    ```
</details>

The response contains the [Invocation ID](/operate/invocation#invocation-identifier).
You can use this identifier [to cancel](/operate/invocation#cancelling-invocations) or [kill the invocation](/operate/invocation#killing-invocations).

<Admonition type={"tip"} title={"Latch onto running invocations with idempotency key and workflows"}>
    You can latch onto running invocations with an idempotency key and workflows. This lets you retrieve their result if they finished, or latch on if they are still ongoing.
    Check [the documentation below for more information](#latching-onto-running-invocations-and-workflows) below.
</Admonition>


## Sending a delayed message over HTTP

You can **delay the message** by adding a delay request parameter in ISO8601 notation or in seconds:

<CH.Code>

    ```shell seconds
    # focus[40:56]
    curl localhost:8080/MyService/myHandler/send?delaySec=10 \
    -H 'content-type: application/json' \
    -d '{"name": "Mary", "age": 25}'
    ```

    ```shell ISO8601
    # focus[40:56]
    curl localhost:8080/MyService/myHandler/send?delay=PT10S \
    -H 'content-type: application/json' \
    -d '{"name": "Mary", "age": 25}'
    ```

</CH.Code>

<Admonition type="note" title={"Not supported for workflows"}>
    You cannot yet use this feature for workflows.
    Workflows can only be scheduled with a delay from within another Restate handler ([TS](/develop/ts/service-communication#delayed-calls)/[Java/Kotlin](/develop/java/service-communication#delayed-calls)).
</Admonition>


## Invoke a handler idempotently

You can send requests to Restate providing an idempotency key, through the [`Idempotency-Key` header](https://datatracker.ietf.org/doc/draft-ietf-httpapi-idempotency-key-header/):

```shell
curl localhost:8080/MyService/myHandler \
# focus
  -H 'idempotency-key: ad5472esg4dsg525dssdfa5loi' \
  -H 'content-type: application/json' \
  -d '{"name": "Mary", "age": 25}'
```

After the invocation completes, Restate persists the response for a retention period of one day (24 hours).
If you re-invoke the service with the same idempotency key within 24 hours, Restate sends back the same response and doesn't re-execute the request to the service.

<Admonition type="tip" title={"Make any service call idempotent with Restate"}>
    With Restate and an idempotency key, you can make any service call idempotent, without any extra code or setup.
    This is a very powerful feature to ensure that your system stays consistent and doesn't perform the same operation multiple times.
</Admonition>

<details className={"grey-details"}>
    <summary> Tuning retention time</summary>

    <CH.Section>
        You can tune the [retention time](focus://3) on a service-level by using the [Admin API](focus://1[15:28]) ([docs](/references/admin-api#tag/service/operation/modify_service)):
        ```shell
        curl -X PATCH localhost:9070/services/MyService \
        -H 'content-type: application/json' \
        -d '{"idempotency_retention": "2days"}'
        ```
        The [retention time](focus://3) is in [humantime format](https://docs.rs/humantime/latest/humantime/).
    </CH.Section>

</details>


## Latching onto running invocations and workflows

Restate allows you to latch onto the ongoing workflows and invocations that had an idempotency token.
There are two options:
- To **attach** to a running invocation or workflow and wait for it to finish, use `/attach`.
- To **peek at the output** of a running invocation or workflow, use `/output`. This will return:
  - `{"message":"not ready"}` for ongoing workflows
  - The result for finished workflows
  - `{"message":"not found"}` for non-existing workflows

<CH.Spotlight start={1} className="durable-promises">

    ```shell
    curl localhost:8080/restate/invocation/myInvocationId/attach
    curl localhost:8080/restate/invocation/myInvocationId/output
    ```

    ---

    Via invocation ID

    ```shell
    curl localhost:8080/restate/invocation/myInvocationId/attach
    curl localhost:8080/restate/invocation/myInvocationId/output
    ```
    ---

    ```shell
    curl localhost:8080/restate/invocation/MyService/myHandler/myIdempotencyKey/attach
    curl localhost:8080/restate/invocation/MyService/myHandler/myIdempotencyKey/output
    ```

    For Services, via [idempotency key](/invoke/http#invoke-a-handler-idempotently)

    ---

    ```shell
    curl localhost:8080/restate/invocation/myObject/myKey/myHandler/myIdempotencyKey/attach
    curl localhost:8080/restate/invocation/myObject/myKey/myHandler/myIdempotencyKey/output
    ```

    For Virtual Objects, via [idempotency key](/invoke/http#invoke-a-handler-idempotently)

    ---

    ```shell
    curl localhost:8080/restate/workflow/MyWorkflow/myWorkflowId/attach
    curl localhost:8080/restate/workflow/MyWorkflow/myWorkflowId/output
    ```

    For Workflows, with the Workflow ID

</CH.Spotlight>
