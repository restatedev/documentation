---
sidebar_position: 3
description: ""
---

import CliAnimation from "../../src/components/CliAnimation";
import FeatureWidget from "../../src/components/FeatureWidget";
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Invocations

An invocation is a request to execute a handler that is part of either a service, or a virtual object.

There are three ways to invoke a handler:


<FeatureWidget features={[
    {
        title: 'HTTP requests',
        iconPath: '/img/http-icon.svg',
        description: (
            <p class="font-size-90">
                Send a request to the Restate Server (port <code>8080</code>), with the handler name in the path, and the payload body.
                <br/>
                <a href="/invoke/http">Learn more</a>
            </p>
        ),
    },
    {
        title: 'Programmatically',
        iconPath: '/img/code-icon.svg',
        description: (
            <p class="font-size-90">
                Use the SDK to send requests within Restate handlers. Or use generated HTTP clients anywhere else.
                <br/>
                <a href="/invoke/clients">Learn more</a>
            </p>
        ),
    },
    {
        title: 'Kafka events',
        iconPath: '/img/kafka-icon.svg',
        description: (
            <p class="font-size-90">
                Restate subscribes to a Kafka topic, and invokes a handler should for each message that arrives.
                <br/>
                <a href="/invoke/kafka">Learn more</a>
            </p>
        ),
    },
]}/>

All invocations are proxied through the Restate Server, which registers the request, routes the request to the correct handler, and drives the execution of the handler.

Invocations get a unique identifier. This identifier is used to track the progress of the invocation, and lets you correlate logs and metrics.

## Invocation types

<Tabs groupId="sdk" queryString>
    <TabItem value="ts" label="TypeScript">
        <CH.Spotlight className="durable-promises">


            <CH.Code rows={20}>

                ```typescript restate_service.ts
                CODE_LOAD::ts/src/concepts/invocations/rpc.ts#<start_rpc_call>-<end_rpc_call>
                ```

                ```typescript plain_node_app.ts
                CODE_LOAD::ts/src/concepts/invocations/ingress/rpc.ts#<start_rpc_call_node>-<end_rpc_call_node>
                ```

            </CH.Code>

            ---

            **<mark class="accent">Request-response</mark> invocations** allow you to wait on a response from the handler.

            ---

            <CH.Code rows={20}>

                ```typescript restate_service.ts
                CODE_LOAD::ts/src/concepts/invocations/one_way.ts#<start_one_way_call>-<end_one_way_call>
                ```

                ```typescript plain_node_app.ts
                CODE_LOAD::ts/src/concepts/invocations/ingress/one_way.ts#<start_one_way_call_node>-<end_one_way_call_node>
                ```

            </CH.Code>

            **<mark class="accent">One-way</mark> invocations** allow you to trigger an asynchronous action.
            This returns an invocation ID with which you can retrieve the result of the invocation later, if desired.

            ---

            <CH.Code rows={20}>

                ```typescript restate_service.ts
                CODE_LOAD::ts/src/concepts/invocations/delayed.ts#<start_delayed_call>-<end_delayed_call>
                ```

                ```typescript plain_node_app.ts
                CODE_LOAD::ts/src/concepts/invocations/ingress/delayed.ts#<start_delayed_call_node>-<end_delayed_call_node>
                ```

            </CH.Code>

            **<mark class="accent">Delayed</mark> invocations** allow you to schedule an invocation for a later point in time.

        </CH.Spotlight>
    </TabItem>
    <TabItem value="java" label="Java">

        <CH.Spotlight className="durable-promises">

            <CH.Code rows={20}>

                ```java RestateService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/RpcCalls.java#<start_rpc>-<end_rpc>
                ```

                ```java PlainJavaService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/RpcCalls.java#<start_rpc_java>-<end_rpc_java>
                ```

            </CH.Code>

            ---



            **<mark class="accent">Request-response</mark> invocations** allow you to wait on a response from the handler.

            ---

            <CH.Code rows={20}>

                ```java RestateService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/OneWayCalls.java#<start_one_way_call>-<end_one_way_call>
                ```

                ```java PlainJavaService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/OneWayCalls.java#<start_one_way_call_java>-<end_one_way_call_java>
                ```


            </CH.Code>

            **<mark class="accent">One-way</mark> invocations** allow you to trigger an asynchronous action.
            This returns an invocation ID with which you can retrieve the result of the invocation later, if desired.

            ---

            <CH.Code rows={20}>

                ```java RestateService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/DelayedCalls.java#<start_delayed_call>-<end_delayed_call>
                ```

                ```java PlainJavaService.java
                CODE_LOAD::java/src/main/java/concepts/invocations/DelayedCalls.java#<start_delayed_call_java>-<end_delayed_call_java>
                ```

            </CH.Code>

            **<mark class="accent">Delayed</mark> invocations** allow you to schedule an invocation for a later point in time.

        </CH.Spotlight>


    </TabItem>
    <TabItem value="shell" label="Shell">

        <CH.Spotlight className="durable-promises">

            ```bash
            curl localhost:8080/GreeterService/greet \
                -H 'content-type: application/json' \
                -d '"Hi"'

            curl localhost:8080/GreetCounter/Mary/greet \
                -H 'content-type: application/json' \
                -d '"Hi"'

            curl localhost:8080/MyWorkflow/wf-id-1/run \
                -H 'content-type: application/json' \
                -d '"Hi"'
            ```

            ---

            **<mark class="accent">Request-response</mark> invocations** allow you to wait on a response from the handler.

            ---

            ```bash
            curl localhost:8080/GreeterService/greet/send \
                -H 'content-type: application/json' \
                -d '"Hi"'

            curl localhost:8080/GreetCounter/Mary/greet/send \
                -H 'content-type: application/json' \
                -d '"Hi"'

            curl localhost:8080/MyWorkflow/wf-id-1/run/send \
                -H 'content-type: application/json' \
                -d '"Hi"'
            ```

            **<mark class="accent">One-way</mark> invocations** allow you to trigger an asynchronous action.
            This returns an invocation ID with which you can retrieve the result of the invocation later, if desired.

            ---

            ```bash
            curl localhost:8080/GreeterService/greet/send?delay=10s \
                -H 'content-type: application/json' \
                -d '"Hi"'

            curl localhost:8080/GreetCounter/Mary/greet/send?delay=10s \
                -H 'content-type: application/json' \
                -d '"Hi"'
            ```

            **<mark class="accent">Delayed</mark> invocations** allow you to schedule an invocation for a later point in time.


        </CH.Spotlight>
    </TabItem>
</Tabs>

## Idempotent invocations
For HTTP requests, you can add an idempotency key to the header to make the invocation idempotent.
Restate will then deduplicate requests with the same idempotency key, and will only execute the handler once.
Duplicate requests will get the same response as the first request, or will latch on to the first invocation if it's still running.

```bash
curl localhost:8080/GreeterService/greet \
# focus
  -H 'idempotency-key: ad5472esg4dsg525dssdfa5loi' \
  -H 'content-type: application/json' \
  -d '"Hi"'
```

Note that, you don't need idempotency tokens for invocations that are invoked programmatically or via Kafka, as Restate will make sure that they are executed only once.

## Inspecting invocations
Restate proxies and manages inbound as well as service-to-service invocations.
This makes it a great source of observability data for your application.
You can inspect invocations via the CLI.

<CliAnimation listOfSteps={[`$ restate services list
     NAME             REVISION  FLAVOR    DEPLOYMENT TYPE  DEPLOYMENT ID
 ðŸŒŽ  CartObject       1         â¬…ï¸ ðŸš¶ðŸš¶ðŸš¶  HTTP 2           dp_11pXug0mWsff2NOoRBZbOcV
 ðŸŒŽ  CheckoutService  1                   HTTP 2           dp_11pXug0mWsff2NOoRBZbOcV
 ðŸŒŽ  TicketObject     1         â¬…ï¸ ðŸš¶ðŸš¶ðŸš¶  HTTP 2           dp_11pXug0mWsff2NOoRBZbOcV`,
    `$ restate services describe CartObject
ðŸ“œ Service Information:
â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
 Name:             CartObject
 Service type:     VirtualObject
 Revision:         1
 Public:           true
 Deployment ID:    dp_11pXug0mWsff2NOoRBZbOcV
 Deployment Type:  HTTP 2
 Protocol Style:   Streaming
 Endpoint:         http://localhost:9080/
 Created at:       2024-04-23T12:32:16.691000000Z


    ðŸ”Œ Handlers:
    â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
     HANDLER       INPUT TYPE                 OUTPUT TYPE
     addTicket     one of "empty or value of  value with content-type "application/json"
                   content-type */*"
     checkout      one of "empty or value of  value with content-type "application/json"
                   content-type */*"
     expireTicket  one of "empty or value of  value with content-type "application/json"
                   content-type */*"`,
    `$ restate invocations list
  â¯ [2024-04-23 14:41:59.365 +02:00] inv_1fmRNvSNVxNp5PTqHI4HLJ17HpxzhB3MEV
     Target:      CartObject/Mary/addTicket
     Status:      backing-off  (18 seconds and 284 ms. Retried 9 time(s). Next
                  retry in in 8 seconds and 220 ms))
     Deployment:  dp_11pXug0mWsff2NOoRBZbOcV [required]
     Error:       [2024-04-23 14:42:13.706 +02:00]
                  [500] Failing
     Caused by:   UNKNOWN`,
    `$ restate invocations describe inv_1fmRNvSNVxNp5PTqHI4HLJ17HpxzhB3MEV
ðŸ“œ Invocation Information:
â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
 Created at:   2024-04-23 14:41:59.365 +02:00 (a minute ago)
 Target:       CartObject/Mary/addTicket
 Status:       backing-off  (1 minute, 23 seconds and 937 ms. Retried 14
               time(s). Next retry in in 991 ms))
 Deployment:   dp_11pXug0mWsff2NOoRBZbOcV [required]
 Error:        [2024-04-23 14:43:13.248 +02:00]
               [500] Failing
 Caused by:    UNKNOWN
 Modified at:  2024-04-23 14:41:59.388 +02:00

      ðŸ’¡   This invocation is bound to run on deployment 'dp_11pXug0mWsff2NOoRBZbOcV'. To guarantee
           safety and correctness, invocations that made progress on a deployment
           cannot move to newer deployments automatically.

    ðŸš‚ Invocation Progress:
    â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•â€•
    [Ingress]
     â””â”€â”€(this)â”€> CartObject/Mary/addTicket
         â–¸
         â”œâ”€â”€â”€â”€ â˜‘ï¸  #1 Call TicketObject/seat2B/reserve inv_19maBIcE9uRD1CrHgpGXZ7FcXPsz4bzkbL
         â””â”€â”€â”€â”€>> backing-off`,
    `$ restate invocations cancel --kill inv_1fmRNvSNVxNp5PTqHI4HLJ17HpxzhB3MEV
  â¯ [2024-04-23 14:41:59.365 +02:00] inv_1fmRNvSNVxNp5PTqHI4HLJ17HpxzhB3MEV
     Target:      CartObject/Mary/addTicket
     Status:      backing-off  (25 minutes, 29 seconds and 200 ms. Retried 141
                  time(s). Next retry in in 12 seconds and 94 ms))
     Deployment:  dp_11pXug0mWsff2NOoRBZbOcV [required]
     Error:       [2024-04-23 15:07:27.860 +02:00]
                  [500] Failing
     Caused by:   UNKNOWN

    âœ” Are you sure you want to kill this invocation Â· yes

    âœ… Request was sent successfully`]}
/>

Restate also exposes traces via OpenTelemetry, which can be sent to your observability platform of choice (e.g. Jaeger).
Have a look at the [tracing documentation](/operate/monitoring/tracing) for more information.

<div className="text--center">
<img src="/img/Jaeger.svg" alt="Jaeger" class="bordered" width="20%"/>
<img src="/img/OpenTelemetry.svg" alt="Jaeger" class="bordered" width="20%"/>
</div>


## Cancelling and killing invocations

The Restate CLI allows you to cancel or kill invocations.
If necessary, you can register compensating actions in your handlers to ensure that the system remains consistent amid cancellations (blog post on [graceful cancellations](https://restate.dev/blog/graceful-cancellations-how-to-keep-your-application-and-workflow-state-consistent/)).

For cancellations, Restate will gracefully stop the handler by executing all compensation actions.
For kills, Restate will immediately stop the handler without executing any compensation actions.


