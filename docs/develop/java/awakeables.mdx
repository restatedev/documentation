---
sidebar_position: 6
description: "Pause invocations while waiting for an external task completion."
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Awakeables

Awakeables pause an invocation while waiting for an external process to complete a task. 
This works as follows:
- You generate an ID with the Restate SDK. This is a simple string object.
- You send the ID to the external process, in any preferred way (e.g. over Kafka, via HTTP,...).
- The external process executes the task and then returns the ID to Restate, optionally together with a payload. 
- Once the ID has been returned to the service, the invocation resumes.

You can use this pattern to execute tasks in non-Restate services, and retrieve the result. This design pattern is also referred to as the callback (task token) pattern.

While waiting for the ID to be returned, Restate suspends the invocation to free up resources for other invocations.
This feature is particularly beneficial for AWS Lambda deployments.
When the invocation is suspended, its costs are reduced to zero.

<Admonition type="caution">
While waiting for an awakeable ID to be returned, singleton services and keyed services (for that single key) will not process other incoming invocations.
They block until the invocation is finished, so until the awakeable ID is returned and the rest of the code has been executed.
</Admonition>

## Using awakeables

You can use awakeables in the SDK by doing the following:

<Tabs groupId="sdk" queryString>
<TabItem value="java" label="Java">

```java
CODE_LOAD::java/src/main/java/develop/Awakeables.java#<start_create>-<end_create>
```

You need to define the deserializer for the payload.
For primitive types, you can do this by using Restate's built-in `dev.restate.sdk.common.CoreSerdes`.
For other types, have a look at the [serialization documentation](/develop/java/serialization).

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
CODE_LOAD::kotlin/src/main/kotlin/develop/Awakeables.kt#<start_create>-<end_create>
```

By default JSON is used to deserialize payloads, using Kotlin serialization.
For other types, have a look at the [serialization documentation](/develop/java/serialization).

</TabItem>
</Tabs>

## Completing awakeables from another Restate service

The external process that received the ID, needs to deliver it back to Restate when the task is done.

If the external process is another Restate service, then you can use the SDK to resolve the awakeable (= to send the ID back).
Use the awakeable ID that you received from the other service, and do the following:

<Tabs groupId="sdk" queryString>
<TabItem value="java" label="Java">

```java
CODE_LOAD::java/src/main/java/develop/Awakeables.java#<start_resolve>-<end_resolve>
```

You need to define the serializer for the payload.
For primitive types, you can do this by using Restate's built-in `dev.restate.sdk.common.CoreSerdes`.
For other types, have a look at the [serialization documentation](/develop/java/serialization).

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
CODE_LOAD::kotlin/src/main/kotlin/develop/Awakeables.kt#<start_resolve>-<end_resolve>
```

By default JSON is used to serialize payloads, using Kotlin serialization.
For other types, have a look at the [serialization documentation](/develop/java/serialization).

</TabItem>
</Tabs>

You can also reject an awakeable, that is completing it with a failure. This will cause the waiting service to throw [a terminal error](/develop/java/error-handling):

<Tabs groupId="sdk" queryString>
<TabItem value="java" label="Java">

```java
CODE_LOAD::java/src/main/java/develop/Awakeables.java#<start_reject>-<end_reject>
```

</TabItem>
<TabItem value="kotlin" label="Kotlin">

```kotlin
CODE_LOAD::kotlin/src/main/kotlin/develop/Awakeables.kt#<start_reject>-<end_reject>
```

</TabItem>
</Tabs>

## Completing awakeables from outside Restate

You can resolve awakeables from outside Restate by sending requests to Restate's ingress `/restate/awakeables` endpoint.

To resolve an awakeable with a JSON payload:

```shell
curl <RESTATE_INGRESS_URL>/restate/awakeables/<AWAKEABLE_ID>/resolve \
  -H 'content-type: application/json' \
  -d '<JSON_VALUE_RESULT>'
```

For example:

```shell
curl localhost:8080/restate/awakeables/prom_1PePOqpIRxZEBjq6h6SI0vkBmwhFskpdbAAAAAQ/resolve \
  -H 'content-type: application/json'
  -d '{"hello": "world"}'
```

To reject an awakeable:

```shell
curl <RESTATE_INGRESS_URL>/restate/awakeables/<AWAKEABLE_ID>/reject \
  -H 'content-type: text/plain' \
  -d '<FAILURE_REASON>'
```

For example:

```shell
curl localhost:8080/restate/awakeables/prom_1PePOqpIRxZEBjq6h6SI0vkBmwhFskpdbAAAAAQ/reject \
  -H 'content-type: text/plain' \
  -d 'Very bad error!'
```
