---
sidebar_position: 10
description: "Receive events from Kafka."
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Admonition from '@theme/Admonition';
import {SubtleStep} from "../../../src/components/Stepper";

# Kafka

You can invoke handlers via Kafka events, by doing the following:


<SubtleStep stepLabel="1" title="Develop an event handler">

    You can invoke any handler via Kafka events.
    The event payload will be (de)serialized as JSON.

    - When invoking **Virtual Object** handlers via Kafka, the key of the Kafka record will be used to determine the Virtual Object key.
    The key needs to be a valid UTF-8 string.
    For each Virtual Object, the events are delivered in the order in which they arrived on the topic partition.
    - When invoking **Service** handlers over Kafka, events are delivered in parallel without ordering guarantees.

    <Admonition type="tip" title="Combining RPC and Kafka within a service/handler">
        Since you can invoke any handler via Kafka events, a single handler can be invoked both by RPC and via Kafka.
    </Admonition>

</SubtleStep>

<SubtleStep stepLabel="2" title="Configure Restate to connect to a Kafka cluster">
    Define the Kafka cluster that Restate needs to connect to in the [Restate configuration file](/operate/configuration#configuration-file):

    ```toml
    [[ingress.kafka-clusters]]
    name = "my-cluster"
    brokers = ["PLAINTEXT://broker:9092"]
    ```

    Check the [configuration docs](/operate/configuration) for more details.
</SubtleStep>

<SubtleStep stepLabel="3" title="Subscribe the event handler to the Kafka topic">
    Let Restate forward events from the Kafka topic to the event handler by creating a subscription using the [Admin API](/references/admin-api):

    ```bash
    curl localhost:9070/subscriptions -H 'content-type: application/json' \
        -d '{
                "source": "kafka://my-cluster/my-topic",
                "sink": "component://MyService/Handle",
                "options": {"auto.offset.reset": "earliest"}
            }'
    ```

    Once you've created a subscription, Restate immediately starts consuming events from Kafka.
    The handler will be invoked for each event received from Kafka.

    The `options` field is optional and accepts any configuration parameter from [librdkafka configuration](https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md).

</SubtleStep>

<Admonition type="info" title="Managing subscriptions">
    Have a look at the [registration docs](/operate/registration#kafka-subscriptions) for more commands to manage subscriptions.
</Admonition>

<details className="grey-details">
    <summary>Event metadata</summary>

    Each event carries within the _`CODE_LOAD::ts/src/develop/kafka.ts#<start_headers>-<end_headers>`_ map the following entries:

    * `restate.subscription.id`: The subscription identifier, as shown by the [Admin API](../../references/admin-api).
    * `kafka.offset`: The record offset.
    * `kafka.partition`: The record partition.
    * `kafka.timestamp`: The record timestamp.

</details>

